<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>L2 Interlude Craft Calculator</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
/* === ТВОИ СТИЛИ НЕ ТРОГАЛ === */
:root{
  --bg:#0b1220;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#f59e0b;
  --border:#2b3a57;
}
body{
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin:0;
  padding:16px;
}
.btn{
  background:#0b1a33;
  color:var(--text);
  border:1px solid #36507a;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
}
.btn.active{
  border-color: var(--accent);
}
.topbar{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}
.top-tabs{ display:flex; gap:8px; }
.list{ margin-top:10px; }
.item-row{
  background:#13203a;
  border:1px solid #223455;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.item-left{ display:flex; gap:10px; align-items:center; }
.icon{
  width:22px;height:22px;border-radius:6px;
}
.badge{
  font-size:11px;
  border:1px solid var(--border);
  padding:2px 6px;
  border-radius:999px;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="top-tabs">
    <button id="tabWeapons" class="btn active">Weapons</button>
    <button id="tabArmors" class="btn">Armors</button>
    <button id="tabJewelry" class="btn">Jewelry</button>
    <button id="tabMaterials" class="btn">Materials</button>
  </div>
</div>

<input id="searchInput" placeholder="Search item" style="width:100%;padding:10px;">
<div class="list" id="itemsList"></div>

<script>
const ITEMS_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vT3_T3hm32yUCZjgm4LQekdl1hdR14IANDhfQXcw6lIJRDghavbJUFj4rYacRryxZJkSip0p54HWram/pub?gid=0&single=true&output=csv';

let ITEMS = [];
let activeCategory = 'weapon';

function parseCSV(text){
  const rows = text.trim().split('\n').map(r=>r.split(','));
  const h = rows.shift();
  return rows.map(r=>{
    const o={}; h.forEach((k,i)=>o[k]=r[i]);
    return o;
  });
}

async function loadItems(){
  const res = await fetch(ITEMS_URL,{cache:'no-store'});
  ITEMS = parseCSV(await res.text());
  render();
}

function isCraftable(it){
  return String(it.craftable).toLowerCase()==='yes';
}

function filterItems(){
  return ITEMS.filter(it=>{
    const cat = String(it.category).toLowerCase();
    if(activeCategory==='materials'){
      return isCraftable(it) && cat==='material';
    }
    return cat===activeCategory;
  });
}

function render(){
  const q = searchInput.value.toLowerCase();
  itemsList.innerHTML = filterItems()
    .filter(it=>
      (it.name_en||'').toLowerCase().includes(q) ||
      (it.name_ru||'').toLowerCase().includes(q)
    )
    .map(it=>`
      <div class="item-row">
        <div class="item-left">
          ${it.icon?`<img class="icon" src="${it.icon}">`:''}
          <div>${it.name_en} — ${it.name_ru}</div>
        </div>
        <span class="badge">${it.category}</span>
      </div>
    `).join('');
}

/* === TAB HANDLERS === */
function setTab(tab,cat){
  document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
  tab.classList.add('active');
  activeCategory=cat;
  render();
}

tabWeapons.onclick=()=>setTab(tabWeapons,'weapon');
tabArmors.onclick =()=>setTab(tabArmors,'armor');
tabJewelry.onclick=()=>setTab(tabJewelry,'jewelry');
tabMaterials.onclick=()=>setTab(tabMaterials,'materials');

searchInput.oninput=render;

loadItems();
</script>

</body>
</html>
